# Vue和React框架的对比
接触前端以来一直有的一个问题.我认为这是除了前端三个最基础的知识外,另外的一个决定性问题了.  
HTML,CSS,JS是前端的最基础知识.接下来最可能遇到的就是上一层的框架选择了.  
以前可能还有JQuery,Angular,Svelte这些的犹豫,到现在,虽然不排除极少部分的情况,我们大概率遇到的选择就是:**到底用Vue还是用React呢?**  
是个见仁见智的问题.本文以列举自己对这两个框架的一些认识,有参考ChatGPT的回答,但更多是自己的一些理解.  

先抛开Nuxt和Next这两个又上一层了的抽象了吧,虽然目前看来是两个框架发展的重点.  

## 混乱对比
### Vue
1. 响应性
2. 模板语法
3. `<script setup>`
4. Composition API
5. Macro APIs

### React
1. 函数式组件
2. Hooks
3. Snapshots

## 响应性 + Composition API VS. Snapshots + Hooks
Vue一个引以为傲的特性就是它的**响应性和模板语法**,据官网介绍,这样的组件组成,"更容易上手".  
确实,HTML≈template, `<script setup>`≈`<script>`.对于习惯"三段式HTML"页面开发的人而言,这种转变还是比较容易,没什么心智模型上的负担的.  

转头看看React, JSX+Hooks,乍看都是复杂的概念.如果要进行开发,仅仅是了解各个Hooks的功能是不足够的.虽然对于我而言,JSX由于跟HTML还是更加相似的,在这一点上不比Vue的模板语法差.  
而且React主张的是一个不变性(Immutability),每次页面的状态就是一张快照(snapshot),如果需要重渲染,那该状态就会被重新赋值,可以说整个页面由于该状态的变化,"全都发生变化了".
Vue的可变性则完全不一样.`Reactive`是个Vue的核心概念,就是说"随变",引起页面重渲染.这可能引起的一个困难就是,time travel没那么容易,状态的变化也没那么容易跟踪定位.  

### 编写组件模式所带来的一些差异
Vue由于推荐"三段式"的组件结构,可能导致的一些缺点是:
* SFC,单文件组件,即一个文件就是一个组件.这从`<script setup>`中,默认采用文件名为组件名这个设定来看可以看出.**Vue官方就是支持一个文件作为一个组件这种做法**.
* 模板内容可能没有那么灵活.这是"规定"所带来的一些限制,如果需要跳出这些限制当然是可以的,但需要额外的手动支持.比如配置jsx,使用额外提供的`h()`.
::: warning
吐槽: 想结合`<script setup>`和jsx的便利,像React那样把状态/事件/JSX写在同一个作用域内,从而实现React没有的"响应式"便利.结果`<script setup>`里不能直接返回JSX.是自己的一次偷鸡失败..
:::

React并不规定一个文件里只有一个组件(当然Vue也可以):一个文件里可以同时导出多个组件,一个大组件里也可以拆分出多个小组件.  
从颗粒度上说,我觉得React是比Vue上更细的.  
你当然可以反驳我Vue也可以高颗粒度.利用Vue的Composition以可以提高组件颗粒度,提高逻辑复用逻辑,这是Vue3的特性.这只是我对React和Vue的"刻板印象",**你的观点才是正确的**.  

**我更喜欢把状态-事件-渲染内容放到一起.** 而且如果这样的组成冗余了,复杂了,也可以对代码进行优化,再次提取到更小单位的逻辑组件当中.一步一步提取直到自认为逻辑单位足够明了.  

### Composition API 和Hooks的一些对比
Vue3引入了很多新的API,最基础的几个有:`ref()`,`reactive()`,`computed()`,`effect()`,`watchEffect()`等等.  
而React hooks,`useState()`,`useEffect()`,`useContext()`,`useReducer()`等等.  

我当时的认识,是从React向Vue转变的.我的看法是:  
* 状态类: `useState()` ≈ `ref()`, `reactive()`,`computed()`
* 事件类: `useEffect` ≈ `effect()`,`watchEffect()`
* 全局注入类: `useContext()` ≈ Vue状态类组成的全局Composition 或是 `provide`+`inject`

React的`useContext()`和`useReducer()`,基本都可以用Vue的基本reactive API组合而成.这是Vue的一个优点.(当然React本身也可以利用几个自己的hooks,构成自定义的hooks就是了).  
基本事件都用function就可以定义了,这我认为是个很好的转变.(Vue2的methods可以说好也可以说不好).  

为什么要将状态类分为三个API,而React只用一个就可以了呢?  
前者把变量的类型进行了分类,同时也保留了自己"计算属性"这一"独创"理解.  
后者得益于组件的渲染方式,不用顾虑类型不同所带来的更新方式不同,也可以把Vue计算属性这一特点,仅仅利用原生的JS功能就可以实现了.  
#### 缓存
React和Vue的状态定义虽然不是完全的等价,比如`computed`还有缓存,而React的"计算属性"如果要实现这个功能,就要额外的包装了.  
**单从缓存这一点上说,我认为Vue的API实现得更好.**  
`useCallback`,`useMemo`,`"use cache"`,你甚至可以说React Compiler,对,这些都能提升React应用的性能,**但,这些都是额外(后来)的操作了.**

## Macro APIs + TS对比
Vue的另一优势是,`defineProps`,`defineEmits`,`defineSlots`等的这些宏编程存在.  
我认为这些是说明组件用法的,很好的方法.它们说明了组件需要接收哪些属性,本组件会"发散"出什么事件,需要接收怎么样的插槽,等等一系列需要预先知道的内容.

### 数据流
说到`defineEmits()`又想到一个区别,为什么React没有向父组件触发事件的机制而Vue有呢?**因为,React的数据是自上而下的,不允许反向操作.**  
React这样的设计是出于多方面考虑的,也算是一种规定吧.  
React里对应的说法是:状态提升, 受控组件.大概就是将子组件的某些状态,放到父组件中,并在父组件中进行统筹控制.

### 插槽 vs. `children`
说到`defineSlots`,我又想起两个框架的区别.  
在React的对应说法是,`{children}`属性.  
Vue里的默认插槽,具名插槽,在React里都以属性的方式,传递给了子组件了,相似的功能后者则需要更为复杂的额外操作.  

**我认为一个React无法实现的功能是:作用域插槽.**  
当然很可能是我对React的认识不深,自己没想到React怎么实现.因为Vue中的这个功能与React的核心概念 **"单向数据流"** 是相悖的.要将子组件的状态暴露给父组件,再对其进行操作.在React就应该直接提升到父组件里了.  
`defineExposed`等的macros,我认为都属于Vue的优势特点了.  

---
关于TS的支持,由于macros的存在,或者说在类型提示方面而言,我认为是Vue做得比React好.  
**没错,也是刻板印象.以你的观点为准.**  

## Nuxt vs. Next
都是更抽象,面向更大规模应用开发的框架了,差异点就有点脱离Vue跟React了.但我认为Next的发展,导致我不得不对这两个框架进行对比.  

随着React Server Component概念的推出,React似乎转变了发展的方向,专注于更大规模的应用开发了.  
但,`"use client"`这条命令,给了我一种用了Next你就要抛弃先前`useState()`,`useEffect()`等这些hooks的感觉.  
因为在Next App Router里,所有的组件**默认都是服务器组件**.服务器组件里是用不了这些原生hooks的,要在对应的组件内特意声明`"use client"`这条命令.  
啊这...

服务器组件的概念,我也不知道是利大于弊还是弊大于利.反正用起来没太感受到带来的便利.  
一些额外的Next优点是:
* 提供效率更高的内置组件,像`<Link>`,`<Image>`等等
* 页面预获取
* `fetch` API的改良
* 基于文件系统的路由(Nuxt也有,但Next的规定貌似更复杂,功能更丰富?)

---
而Nuxt,我对它的认识比较少,但不得不一个巨好用的功能是,一个项目可以启动两个端口,一个作为客户端渲染,另一个作为服务器返回数据.  
没错这个功能我是真喜欢,这才符合"全栈"的概念.  

再看看Next,我没看出"服务器"的功能在哪里.可能说是`ServerAction`?  
可是!里面还是要使用`fetch`,另外起服务器端口再返回数据.(我????)  
我都全栈了你还要我另起服务端口!??!!!差评.  

---
个人理解先大概梳理到这吧. To be continued...

## Bonus
梳理完自己对两个框架的差异,"参考"一下ChatGPT的回答,或许某些点又有"感同身受"呢?  

**Vue3的优点:**  
1. 易上手
2. 响应式系统
3. 组合式API
4. 灵活性
5. 生态系统丰富
6. 内置的状态管理
7. 文档友好
8. 样式封装

**缺点:**
1. 社区支持不如React丰富
2. 大型项目管理需要更谨慎的规划

**React的优点:**
1. 广泛的社区和生态系统
2. 组件复用
3. 强大的性能
4. 企业级应用
5. 跨平台

**缺点:**  
1. 学习曲线
2. JSX语法
3. 频繁的更新
4. 过度灵活性
5. 依赖管理

**总结:**
* 选择Vue3: 上手速度快,语法结构清晰,项目规模较小;
* 选择React: 灵活性更大, 生态系统更为丰富, 更适用于大型企业级应用开发.

(你是否赞同呢?我怎么觉得不少"刻板印象"...)